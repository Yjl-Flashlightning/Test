# MATLAB LAB Report
# 实验1 利用DFT分析信号频谱



## 实验目的

1. 加深对DFT原理的理解。
1. 应用DFT分析信号的频谱。
1. 深刻理解利用DFT分析信号频谱的原理，分析实现过程中出现的现象及解决方法。



## 实验设备与环境

计算机、MATLAB软件环境。



## 实验基础理论

### DFT与FFT的关系

有限长序列$x(n)(0\le n\le N-1)$的离散时间傅里叶变换$X(e^{j\omega})$在频率区间$(0\le \omega \le 2\pi)$的$N$个等间隔分布的点$k\omega=2\pi k/N(0\le k \le N-1)$上的$N$个取样值可以由下式表示：
$$
X(e^{j\omega})|_{\omega=2\pi k/N}=\sum_{k=0}^{N-1}x(n)e^{-j\frac{2\pi}{N}kn}=X(k)\ \ \ \ 0\le k\le N-1 \tag{2-1}
$$
由上式可知，序列$x(n)$的$N$点DFT$X(k)$，实际上就是$x(n)$序列的DTFT在$N$个等间隔频率点$k\omega=2\pi k/N(0\le k \le N-1)$上样本$X(k)$。

### 利用DFT求DTFT

**方法1：**由$X(k)$恢复出$X(e^{j\omega})$的方法如图2.1所示：

![image-20241118171128628](https://gitee.com/zhaotianxing/picbed/raw/master/img/202411181711689.png)

由图2.1所示流程可知：
$$
X(e^{j\omega})=\sum_{n=-\infty}^\infty x(n)e^{-j\omega n}=\frac{1}{N}\sum_{n=-\infty}^\infty \left[\sum_{k=0}^{N-1}X(k)W_N^{-kn} \right]e^{-j\omega n} \tag{2-2}
$$
由式2-2可以得到
$$
X(e^{j\omega})=\sum_{k=1}^NX(k)\phi(\omega-\frac{2\pi k}{N}) \tag{2-3}
$$
其中$\phi(x)$为内插函数
$$
\phi(\omega)=\frac{\sin(N\omega /2)}{N\sin(\omega /2)}\cdot e^{-j\omega \frac{N-1}{2}} \tag{2-4}
$$
**方法2：**然而在实际MATLAB计算中，上述插值运算不见得是最好的办法。由于DFT是DTFT的取样值，其相邻两个频率样本点的间距为$2\pi/N$，所以如果我们增加数据的长度 $N$，使得到的DFT谱线就更加精细，其包络就越接近DTFT的结果，这样就可以利用DFT来近似计算DTFT。如果没有更多的数据，可以通过补零来增加数据长度。

### 利用DFT分析连续时间信号的频谱

采用计算机分析连续时间信号的频谱，第一步就是把连续时间信号离散化，这里需要进行两个操作：一是采样，二是截断。

对于连续时间非周期信号$x_a(t)$，按采样间隔$T$进行采样，截取长度为$M$，那么
$$
X_a(j\Omega)=\int_{-\infty}^{\infty}x_a(t)e^{-j\Omega t}dt=T\sum_{n=0}^{M-1}x_a(nT)e^{-j\Omega nT} \tag{2-5}
$$
对$X_a(j\Omega)$进行$N$点频域采样，得到
$$
X_a(j\Omega)|_{\Omega=k\frac{2\pi}{NT}}=T\sum_{n=0}^{M-1}x_a(nT)e^{-j\frac{2\pi}{N}kn}=TX_M(k) \tag{2-6}
$$
因此，可以将利用DFT分析连续非周期信号频谱的步骤归纳如下：

1. 确定时域采样间隔$T$，得到离散序列$x(n)$；
2. 确定截取长度$M$，得到$M$点离散序列$x_M(n)=x(n)w(n)$，这里$w(n)$为窗函数；
3. 确定频域采样点数$N$，要求$N \ge M$。 
4. 利用FFT计算离散序列的$N$点DFT，得到)$X_M(k)$。 
5. 根据式（2-6）由$X_M(k)$计算$X_a(j\Omega)$采样点的近似值。

采用上述方法计算$x_a(t)$的频谱，需要注意如下三个问题： 

1. 频谱混叠。如果不满足采样定理的条件，频谱会出现混叠误差。对于频谱无限宽的信号，应考虑覆盖大部分主要频率分量的范围。
2. 栅栏效应和频谱分辨率。使用DFT计算频谱，得到的结果只是N个频谱样本值，样本值之间的频谱是未知的，像通过一个栅栏观察频谱，称为“栅栏效应”。频谱分辨率与记录长度成反比，要提高频谱分表率，就要增加记录时间。
3. 频谱泄露。对信号截断会把窗函数的频谱引入信号频谱，造成频谱泄露。解决这个问题的主要办法是采用旁瓣小的窗函数，频谱泄露和窗函数均会引起误差。

因此，要合理选取采样间隔和截取长度，必要时还需考虑加适当的窗。

对于连续时间周期信号，我们在采用计算机进行计算时，也总是要进行截断，序列总是有限长的，仍然可以采用上述方法近似计算。

### 可能用到的MATLAB函数与代码

实验中DFT运算可采用MATLAB中提供的函数fft来实现。

DTFT可以利用MATLAB矩阵运算的方法进行计算

$$
X(e^{j\Omega})=\sum_{n=n_1}^{n_N}x[n]e^{-j\Omega n}=\begin{bmatrix}x[n_1],x[n_2],\cdots,x[n_N]\end{bmatrix}\cdot \begin{bmatrix}e^{-jn_1\Omega}\\e^{-jn_2\Omega}\\\vdots\\e^{-jn_N\Omega}\end{bmatrix} \tag{2-7}
$$
**例E2-1** 设$x(n)=(-0.8)^n$，$0\le n \le 10$，试用MATLAB近似计算其频谱，并绘制其$[0,2\pi]$区间的曲线。

**解：**我们在$[0,2\pi]$区间上以$0.01\pi$进行取样，计算对应频率上频谱的样本值。

~~~matlab
%Ex_2_1.m
 n=0:10;x=(-0.8).^n;
 w=0:0.01*pi:2*pi;
 X=x*exp(-j*n'*w);
 subplot(211);
 plot(w,abs(X));xlabel('\Omega/\pi');title('Magnitude');axistight
 subplot(212);
 plot(w,angle(X)/pi);xlabel('\Omega/\pi');title('Phase');axistight
~~~

计算得到的频谱曲线如图所示。

![image-20241119175506754](https://gitee.com/zhaotianxing/picbed/raw/master/img/202411191755862.png)



## 实验内容

1. 已知$x(n)={2,-1,1,1}$，完成如下要求：

   （1）计算其DTFT，并画出$[-\pi ,\pi]$区间的波形。 

   （2）计算4点DFT，并把结果显示在（1）所画的图形中。

   （3）对$x(n)$补零，计算64点DFT，并显示结果。 

   （4）根据实验结果，分析是否可以由DFT计算DTFT，如果可以，如何实现。

2. 考察序列
   $$
   x(n)=\cos(0.48\pi n)+\cos(0.52\pi n)
   $$
   （1）$0\le n \le 10$时，用DFT估计$x(n)$的频谱。

   （2）将$x(n)$补零加长到长度为100点序列用DFT估计$x(n)$的频谱。要求画出相应波形。

3. 已知信号$x(t)=0.15\sin(2\pi f_1t)+\sin(2\pi f_2t)-0.1\sin(2\pi f_3t)$，其中$f_1=1Hz$，$f_2=2Hz$，$f_3=3Hz$，从$x(t)$的表达式可以看出，它包含三个频率的正弦波，但是，从其时域波形（图E2-1）来看，似乎是一个正弦信号，利用DFT做频谱分析，确定适合的参数，使得到的频谱的频率分辨率符合需要。

   ![image-20241119180245723](https://gitee.com/zhaotianxing/picbed/raw/master/img/202411191802813.png)

4. 利用DFT近似分析连续时间信号$x(t)=e^{-0.1t}u(t)$的频谱（幅度谱）。分析采用不同的采样间隔和截取长度进行计算的结果，并最终确定适合的参数。


# 实验2利用FFT计算线性卷积



## 实验目的

1. 掌握利用FFT计算线性卷积的原理及具体实现方法。
2. 加深理解重叠相加法和重叠保留法。
3. 考察利用FFT计算线性卷积各种方法的适用范围。



## 实验设备与环境

计算机、MATLAB软件环境。



## 实验基础理论

### 线性卷积与圆周卷积

设$x(n)$为$L$点序列，$h(n)$为$M$点序列，$x(n)$和$h(n)$的线性卷积为
$$
y_l(n)=x(n)*h(n)=\sum_{m=-\infty}^\infty x(m)h(n-m) \tag{3-1}
$$
$y_l$的长度为$L+M-1$。

$x(n)$和$h(n)$的$N$点圆周卷积为
$$
y(n)=x(n)\otimes h(n)=\sum_{m=0}^{N-1}x(m)h\big((n-m)\big)_NR_N(n) \tag{3-2}
$$
圆周卷积与线性卷积相等而不产生交叠的必要条件为
$$
N\ge L+M-1 \tag{3-3}
$$
**圆周卷积定理：**根据DFT的性质，$x(n)$和$h(n)$的$N$点圆周卷积的DFT等于他们DFT的乘积
$$
DFT[x(n)\otimes h(n)]=X(k)H(k) \tag{3-4}
$$

### 快速卷积

快速卷积算法用圆周卷积实现线性卷积，根据圆周卷积定理利用FFT算法实现圆周卷积。可以将快速卷积的步骤归纳如下：

（1）为了使线性卷积可以用圆周卷积来计算，必须选择$N\ge L+M-1$；同时为了能使用基-2FFT完成卷积运算，要求$N=2^\nu$。采用补零的办法使$x(n)$和$h(n)$的长度均为$N$。

（2）计算$x(n)$和$h(n)$的$N$点FFT
$$
\begin{aligned}&x(n)\xrightarrow{FFT}X(k)\\&h(n)\xrightarrow{FFT}H(k)\end{aligned} \tag{3-5}
$$
（3）组成乘积
$$
Y(k)=X(k)H(k) \tag{3-6}
$$
（4）利用IFFT计算$Y(k)$的IDFT，得到线性卷积$y(n)$
$$
Y(k)\xrightarrow{IFFT}y(n) \tag{3-7}
$$

### 分段卷积

我们考察单位取样相应为$h(n)$的线性系统，输入为$x(n)$，输出为$y(n)$，则
$$
y(n)=x(n)*h(n) \tag{3-8}
$$
当输入序列$x(n)$极长时，如果要等$x(n)$全部集齐时再开始进行卷积，会使输出相对输入有较大的延时，再者如果序列太长，需要大量的存储单元。为此，我们把$x(n)$分段，分别求出每段的卷积，合在一起得到最后总的输出。这种方法称为分段卷积。分段卷积可细分为重叠相加法和重叠保留法。

### 可能用到的MATLAB函数

实验中FFT运算可采用MATLAB中提供的函数**fft**来实现。 MATLAB提供了函数**conv**用来计算线性卷积，实验中可以将编程计算的结果和**conv**函数的计算结果相比较，以验证结果的正确性，**conv**函数用法如下

~~~matlab
y=conv(x,h) 
~~~

x和h为要进行卷积运算的两个序列，y为卷积结果。

统计程序运行时间可以利用MATLAB提供的**tic**和**toc**两个命令，具体用法如下：

~~~matlab
tic
 ........需要运行的程序代码
toc
~~~

即，在需要统计运行时间的程序代码之前加上**tic**命令，之后加上**toc**命令，此时会在命令窗口中显示该程序的运行时间，例如将下列代码写入一个m文件并执行

~~~matlab
tic
 A=[1,2;3,4];B=[5,6;7,8];
 x=A/B;
 toc
~~~

命令窗口中显示

~~~matlab
Elapsedtimeis0.000058seconds.
~~~

即执行上述代码耗费时间0.000058秒。



## 实验内容

假设要计算序列$x(n)=u(n)-u(n-L)$，$0 \le n \le L$和$h(n)=cos(0.2\pi n)$，$0 \le n \le M$的线性卷积，完成以下实验内容。

1. 设$L=M$，根据线性卷积的表达式和快速卷积的原理，分别编程实现计算两个序列线性卷积的方法，比较当序列长度分别为8，16，32，64，256，512，1024时，两种方法计算线性卷积所需时间。
2. 当$L=2048$且$M=256$时，比较直接计算线性卷积和快速卷积所需的时间，进一步考察当$L=4096$且$M=256$时两种算法所需的时间。
3. 编程实现利用重叠相加法计算两个序列的线性卷积，考察$L=2048$且$M=256$时计算线性卷积的时间，与第2题的结果进行比较。
4. 编程实现利用重叠保留法计算两个序列的线性卷积，考察$L=2048$且$M=256$时计算线性卷积的时间，与第2题的结果进行比较。


